!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.kami=a():"undefined"!=typeof global?global.kami=a():"undefined"!=typeof self&&(self.kami=a())}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("jsOOP").Class,d=a("./glutils/Mesh"),e=new c({_blendSrc:null,_blendDst:null,_blendEnabled:!0,initialize:function(a,b){if(!a)throw"GL context not specified";if(this.context=a,this.size=b||500,this.size>10922)throw"Can't have more than 10922 sprites per batch: "+this.size;this.shader=this._createShader(),this._blendSrc=this.context.gl.ONE,this._blendDst=this.context.gl.ONE_MINUS_SRC_ALPHA,this._blendEnabled=!0,this.idx=0,this.drawing=!1,this.mesh=this._createMesh(this.size)},_createMesh:function(a){var b=4*a*this.getVertexSize(),c=6*a,e=this.context.gl;this.vertices=new Float32Array(b),this.indices=new Uint16Array(c);for(var f=0,g=0;c>f;f+=6,g+=4)this.indices[f+0]=g+0,this.indices[f+1]=g+1,this.indices[f+2]=g+2,this.indices[f+3]=g+0,this.indices[f+4]=g+2,this.indices[f+5]=g+3;var h=new d(this.context,!1,b,c,this._createVertexAttributes());return h.vertices=this.vertices,h.indices=this.indices,h.vertexUsage=e.DYNAMIC_DRAW,h.indexUsage=e.STATIC_DRAW,h.dirty=!0,h},_createShader:function(){throw"_createShader not implemented"},_createVertexAttributes:function(){throw"_createVertexAttributes not implemented"},getVertexSize:function(){throw"getVertexSize not implemented"},begin:function(){if(this.drawing)throw"batch.end() must be called before begin";this.drawing=!0,this.shader.bind(),this.mesh.bind(this.shader)},end:function(){if(!this.drawing)throw"batch.begin() must be called before end";this.idx>0&&this.flush(),this.drawing=!1,this.mesh.unbind(this.shader)},_preRender:function(){},_postRender:function(){},flush:function(){if(0!==this.idx){var a=this.gl;this._preRender();var b=this.getVertexSize(),c=this.idx/(4*b),a=this.context.gl;this.mesh.verticesDirty=!0,this.mesh.draw(a.TRIANGLES,6*c,0),this.idx=0}},draw:function(){},drawVertices:function(){},destroy:function(){this.vertices=[],this.indices=[],this.size=this.maxVertices=0,this.mesh.destroy()}});b.exports=e},{"./glutils/Mesh":7,jsOOP:11}],2:[function(a,b){var c=a("jsOOP").Class,d=a("signals"),e=new c({assets:null,tasks:null,__loadCount:0,__totalItems:0,__loadCallbackFunc:null,__invalidateFunc:null,loadStarted:null,loadFinished:null,loadProgress:null,loadError:null,remaining:{get:function(){return this.__totalItems-this.__loadCount}},total:{get:function(){return this.__totalItems}},initialize:function(a){if(!a)throw"no context defined for AssetManager";this.assets=[],this.loaders={},this.tasks=[],this.__loadCount=this.__totalItems=0,this.loadStarted=new d,this.loadFinished=new d,this.loadProgress=new d,this.__invalidateFunc=this.invalidate.bind(this),this.__loadCallbackFunc=this.__loadCallback.bind(this),this.context=a,this.context.lost.add(this.__invalidateFunc)},destroy:function(){this.assets=[],this.tasks=[],this.__loadCount=this.__totalItems=0,this.context.lost.remove(this.__invalidateFunc)},invalidate:function(){for(var a=0;a<this.assets.length;a++)this.assets[a].loaded=!1;this.tasks=this.assets.slice(),this.__loadCount=this.__totalItems=this.tasks.length},load:function(a){var b=this.__extension(a);if(!b)throw"Asset name does not have a file extension: "+a;if(!e.loaders.hasOwnProperty(b))throw"No known loader for extension "+b+" in asset "+a;var c=[a,e.loaders[b]];return c=c.concat(Array.prototype.slice.call(arguments,1)),this.loadAs.apply(this,c)},__extension:function(a){var b=a.lastIndexOf(".");return-1===b||0===b||b===a.length-1?"":a.substring(b+1).toLowerCase()},loadAs:function(a,b){if(!a)throw"no name specified to load";if(!b)throw"no loader specified for asset "+a;var c=this.__indexOf(this.assets,a);if(-1!==c)throw"asset already defined in asset manager";var d=Array.prototype.slice.call(arguments,2),f=new e.Descriptor(a,b,d);return this.assets.push(f),this.tasks.push(f),this.__loadCount++,this.__totalItems++,b.processArguments?b.processArguments.call(this,a,d):null},__indexOf:function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return c;return-1},__loadCallback:function(a,b){if(arguments.length<2)throw"Loader passed invalid arguments to finished() callback; must include name and success flag";this.__loadCount--;var c=this.__indexOf(this.assets,a);-1!==c&&(this.assets[c].status=b?e.Status.LOAD_SUCCESS:e.Status.LOAD_FAILED,b||this.loadError.dispatch(a)),this.loadProgress.dispatch(this.__totalItems-this.__loadCount,this.__totalItems,a),0===this.__loadCount&&this.loadFinished.dispatch()},update:function(){if(!this.context.valid)return!1;if(0===this.tasks.length)return 0===this.__loadCount;this.tasks.length===this.assets.length&&this.loadStarted.dispatch();var a=this.tasks.shift(),b=a.loader,c=this.__loadCallbackFunc,d=[a.name,c].concat(a.params);return b.loadAsset.apply(this,d),0===this.__loadCount}});e.loaders={},e.registerLoader=function(a){if(0===arguments.length)throw"must specify at least one extension for the loader";for(var b=Array.prototype.slice.call(arguments,1),c=0;c<b.length;c++)e.loaders[b[c]]=a},e.Descriptor=new c({name:null,loader:null,params:null,status:null,initialize:function(a,b,c){this.name=a,this.loader=b,this.params=c,this.status=e.Status.QUEUED}}),e.Status={QUEUED:0,LOADING:1,LOAD_SUCCESS:2,LOAD_FAIL:3},e.ImageLoader={loadAsset:function(a,b,c,d){if(!c)throw"no texture object specified to the ImageLoader for asset manager";d=d||a;var e=new Image;e.onload=function(){e.onerror=e.onabort=null,c.uploadImage(e),b(a,!0)},e.onerror=function(){e.onload=e.onabort=null,console.warn("Error loading image: "+d),c.uploadData(1,1),b(a,!1)},e.onabort=function(){e.onload=e.onerror=null,console.warn("Aborted image: "+d),c.uploadData(1,1),b(a,!1)},e.src=d},processArguments:function(a,b){return 0!==b.length&&b[0]?b[0]:b[0]=new Texture(this.context)}},e.registerLoader(e.ImageLoader,"png","gif","jpg","jpeg"),b.exports=e},{jsOOP:11,signals:16}],3:[function(a,b){var c=a("jsOOP").Class,d=a("gl-matrix").vec2,e=new c({items:null,initialize:function(a,b){a=a||0,b=b||0,this.items=d.fromValues(a,b)},x:{get:function(){return this.items[0]},set:function(a){this.items[0]=a}},y:{get:function(){return this.items[1]},set:function(a){this.items[1]=a}},toString:function(){return"("+this.x+", "+this.y+")"}});b.exports=e},{"gl-matrix":10,jsOOP:11}],4:[function(a,b){var c=a("jsOOP").Class,d=a("./AbstractBatch"),e=a("./Point"),f=a("./glutils/Mesh"),g=a("./glutils/ShaderProgram"),h=new c({Extends:d,useProjectionVector:!0,projection:null,initialize:function(a,b){this.parent(a,b),this.texture=null,this.projection=new e(0,0)},getVertexSize:function(){return h.VERTEX_SIZE},_createVertexAttributes:function(){return[new f.Attrib("Position",2),new f.Attrib("Color",1),new f.Attrib("TexCoord0",2)]},setProjection:function(a,b){var c=this.projection.x,d=this.projection.y;this.projection.x=a,this.projection.y=b,!this.drawing||a==c&&b==d||(this.flush(),this._updateMatrices())},_createShader:function(){var a=new g(this.context,h.DEFAULT_VERT_SHADER,h.DEFAULT_FRAG_SHADER);return a.log&&console.warn("Shader Log:\n"+a.log),a},updateMatrices:function(){this.useProjectionVector&&this.shader.setUniformfv("u_projection",this.projection.items)},_preRender:function(){this.texture&&this.texture.bind()},begin:function(){var a=this.context.gl;d.prototype.begin.call(this),this.updateMatrices(),this.shader.setUniformi("u_texture0",0),a.depthMask(!1),this._blendEnabled&&(a.enable(a.BLEND),-1!==this._blendSrc&&-1!==this._blendDst&&a.blendFunc(this._blendSrc,this._blendDst))},end:function(){var a=this.context.gl;d.prototype.end.call(this),a.depthMask(!0),this._blendEnabled&&a.disable(a.BLEND)},flush:function(){this.texture&&0!==this.idx&&(d.prototype.flush.call(this),h.totalRenderCalls++)},draw:function(a,b,c,d,e,f,g,h,i,j){if(!this.drawing)throw"Illegal State: trying to draw a batch before begin()";if(a){null===this.texture||this.texture.id!==a.id?(this.flush(),this.texture=a):this.idx==this.vertices.length&&this.flush(),d=0===d?d:d||a.width,e=0===e?e:e||a.height,b=b||0,c=c||0;var k=b,l=b+d,m=c,n=c+e;g=g||0,i=0===i?i:i||1,h=h||0,j=0===j?j:j||1;var o=0===f?f:f||1;this.vertices[this.idx++]=k,this.vertices[this.idx++]=m,this.vertices[this.idx++]=o,this.vertices[this.idx++]=g,this.vertices[this.idx++]=h,this.vertices[this.idx++]=l,this.vertices[this.idx++]=m,this.vertices[this.idx++]=o,this.vertices[this.idx++]=i,this.vertices[this.idx++]=h,this.vertices[this.idx++]=l,this.vertices[this.idx++]=n,this.vertices[this.idx++]=o,this.vertices[this.idx++]=i,this.vertices[this.idx++]=j,this.vertices[this.idx++]=k,this.vertices[this.idx++]=n,this.vertices[this.idx++]=o,this.vertices[this.idx++]=g,this.vertices[this.idx++]=j}},drawVertices:function(a,b,c){if(!this.drawing)throw"Illegal State: trying to draw a batch before begin()";a&&(this.texture!=a?(this.flush(),this.texture=a):this.idx==this.vertices.length&&this.flush(),c=c||0,this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++])}});h.VERTEX_SIZE=5,h.totalRenderCalls=0,h.DEFAULT_FRAG_SHADER=["precision mediump float;","varying vec2 vTexCoord0;","varying float vColor;","uniform sampler2D u_texture0;","void main(void) {","   gl_FragColor = texture2D(u_texture0, vTexCoord0) * vColor;","}"].join("\n"),h.DEFAULT_VERT_SHADER=["attribute vec2 Position;","attribute float Color;","attribute vec2 TexCoord0;","uniform vec2 u_projection;","varying vec2 vTexCoord0;","varying float vColor;","void main(void) {","   gl_Position = vec4( Position.x / u_projection.x - 1.0, Position.y / -u_projection.y + 1.0 , 0.0, 1.0);","   vTexCoord0 = TexCoord0;","   vColor = Color;","}"].join("\n"),b.exports=h},{"./AbstractBatch":1,"./Point":3,"./glutils/Mesh":7,"./glutils/ShaderProgram":8,jsOOP:11}],5:[function(a,b){var c=a("jsOOP").Class,d=a("signals"),e=new c({id:null,target:null,width:0,height:0,wrap:null,filter:null,initialize:function(a){if(!a)throw"GL context not specified";this.context=a,this.created=new d;var b=[this],c=null;if(arguments.length>1){var f=[];"string"==typeof arguments[1]?(c=e.ImageProvider,f=Array.prototype.slice.call(arguments,1)):"function"==typeof arguments[1]?(c=arguments[1],f=Array.prototype.slice.call(arguments,2)):arguments.length>2&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&(c=e.ArrayProvider,f=Array.prototype.slice.call(arguments,1)),b=b.concat(f)}this.wrapS=this.wrapT=e.DEFAULT_WRAP,this.minFilter=this.magFilter=e.DEFAULT_FILTER,this.provider=c,this.providerArgs=b,this.context.addManagedObject(this),this.create()},create:function(){this.gl=this.context.gl;var a=this.gl;this.id=a.createTexture(),this.width=this.height=0,this.target=a.TEXTURE_2D,this.bind(),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.setWrap(this.wrapS,this.wrapT,!1),this.setFilter(this.minFilter,this.magFilter,!1),this.provider&&this.provider.apply(this,this.providerArgs)},destroy:function(){this.id&&this.gl&&this.gl.deleteTexture(this.id),this.context&&this.context.removeManagedObject(this),this.width=this.height=0,this.id=null,this.provider=null,this.providerArgs=null},setWrap:function(a,b,c){a&&b?(this.wrapS=a,this.wrapT=b):this.wrapS=this.wrapT=a,c||this.bind();var d=this.gl;d.texParameteri(this.target,d.TEXTURE_WRAP_S,this.wrapS),d.texParameteri(this.target,d.TEXTURE_WRAP_T,this.wrapT)},setFilter:function(a,b,c){a&&b?(this.minFilter=a,this.magFilter=b):this.minFilter=this.magFilter=a,c||this.bind();var d=this.gl;d.texParameteri(this.target,d.TEXTURE_MIN_FILTER,this.minFilter),d.texParameteri(this.target,d.TEXTURE_MAG_FILTER,this.magFilter)},uploadData:function(a,b,c,d,e){var f=this.gl;this.format=c||f.RGBA,d=d||f.UNSIGNED_BYTE,e=e||null,this.width=a||0==a?a:this.width,this.height=b||0==b?b:this.height,this.bind(),f.texImage2D(this.target,0,this.format,this.width,this.height,0,this.format,d,e)},uploadImage:function(a,b,c){var d=this.gl;this.format=b||d.RGBA,c=c||d.UNSIGNED_BYTE,this.width=a.width,this.height=a.height,this.bind(),d.texImage2D(this.target,0,this.format,this.format,c,a)},bind:function(a){var b=this.gl;(a||0===a)&&b.activeTexture(b.TEXTURE0+a),b.bindTexture(this.target,this.id)},toString:function(){return this.id+":"+this.width+"x"+this.height}});e.Filter={NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985},e.Wrap={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},e.Format={DEPTH_COMPONENT:6402,ALPHA:6406,RGBA:6408,RGB:6407,LUMINANCE:6409,LUMINANCE_ALPHA:6410},e.DEFAULT_WRAP=e.Wrap.CLAMP_TO_EDGE,e.DEFAULT_FILTER=e.Filter.NEAREST,e.ImageProvider=function(a,b,c,d,e,f){var g=new Image;g.onload=function(){a.uploadImage(g,e,f),c&&"function"==typeof c&&c.call(a,a)},g.onerror=function(){d&&"function"==typeof d&&d.call(a,a)},g.onabort=function(){d&&"function"==typeof d&&d.call(a,a)},g.src=b},e.ArrayProvider=function(a,b,c,d,e,f){a.uploadData(b,c,d,e,f)},e.getNumComponents=function(a){switch(a){case e.Format.DEPTH_COMPONENT:case e.Format.ALPHA:case e.Format.LUMINANCE:return 1;case e.Format.LUMINANCE_ALPHA:return 2;case e.Format.RGB:return 3;case e.Format.RGBA:return 4}return null},b.exports=e},{jsOOP:11,signals:16}],6:[function(a,b){var c=a("jsOOP").Class,d=a("signals"),e=new c({managedObjects:null,gl:null,width:null,height:null,view:null,contextAttributes:null,valid:!1,lost:null,restored:null,initialize:function(a,b,c,e){this.lost=new d,this.restored=new d,this.view=c||document.createElement("canvas"),this.width=this.view.width=a||300,this.height=this.view.height=b||150,this.managedObjects=[],this.view.addEventListener("webglcontextlost",function(a){a.preventDefault(),this._contextLost(a)}.bind(this)),this.view.addEventListener("webglcontextrestored",function(a){a.preventDefault(),this._contextRestored(a)}.bind(this)),this.contextAttributes=e,this._initContext(),this.resize(this.width,this.height)},_initContext:function(){this.valid=!1;try{this.gl=this.view.getContext("webgl")||this.view.getContext("experimental-webgl")}catch(a){this.gl=null}if(!this.gl)throw"WebGL Context Not Supported -- try enabling it or using a different browser";this.valid=!0},resize:function(a,b){this.width=a,this.height=b,this.view.width=a,this.view.height=b;var c=this.gl;c.viewport(0,0,this.width,this.height)},addManagedObject:function(a){this.managedObjects.push(a)},removeManagedObject:function(a){var b=this.managedObjects.indexOf(a);return b>-1?(this.managedObjects.splice(b,1),a):null},_contextLost:function(){this.valid=!1,this.lost.dispatch(this)},_contextRestored:function(){this.assetManager&&this.assetManager.invalidate(),this._initContext();for(var a=0;a<this.managedObjects.length;a++)this.managedObjects[a].create();this.resize(this.width,this.height),this.restored.dispatch(this)}});b.exports=e},{jsOOP:11,signals:16}],7:[function(a,b){var c=a("jsOOP").Class,d=new c({context:null,gl:null,numVerts:null,numIndices:null,vertices:null,indices:null,vertexBuffer:null,indexBuffer:null,verticesDirty:!0,indicesDirty:!0,indexUsage:null,vertexUsage:null,_vertexAttribs:null,_vertexStride:null,dirty:{set:function(a){this.verticesDirty=a,this.indicesDirty=a}},initialize:function(a,b,c,d,e){if(!a)throw"GL context not specified";if(!c)throw"numVerts not specified, must be > 0";this.context=a,this.gl=a.gl,this.numVerts=c,this.numIndices=d||0,this.vertexUsage=b?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW,this.indexUsage=b?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW,this._vertexAttribs=e||[],this.indicesDirty=!0,this.verticesDirty=!0;for(var f=0,g=0;g<this._vertexAttribs.length;g++)f+=this._vertexAttribs[g].numComponents;this._vertexStride=4*f,this.vertices=new Float32Array(this.numVerts),this.indices=new Uint16Array(this.numIndices),this.context.addManagedObject(this),this.create()},create:function(){this.gl=this.context.gl;var a=this.gl;this.vertexBuffer=a.createBuffer(),this.indexBuffer=this.numIndices>0?a.createBuffer():null,this.dirty=!0},destroy:function(){this.vertices=[],this.indices=[],this.vertexBuffer&&this.gl.deleteBuffer(this.vertexBuffer),this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer),this.vertexBuffer=null,this.indexBuffer=null,this.context&&this.context.removeManagedObject(this)},_updateBuffers:function(a){var b=this.gl;this.numIndices>0&&(a||b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.indicesDirty&&(b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,this.indexUsage),this.indicesDirty=!1)),a||b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),this.verticesDirty&&(b.bufferData(b.ARRAY_BUFFER,this.vertices,this.vertexUsage),this.verticesDirty=!1)},draw:function(a,b,c){if(0!==b){var d=this.gl;c=c||0,this._updateBuffers(!0),this.numIndices>0?d.drawElements(a,b,d.UNSIGNED_SHORT,2*c):d.drawArrays(a,c,b)}},bind:function(a){var b=this.gl,c=0,d=this._vertexStride;this._updateBuffers();for(var e=0;e<this._vertexAttribs.length;e++){var f=this._vertexAttribs[e],g=null===f.location?a.getAttributeLocation(f.name):f.location;b.enableVertexAttribArray(g),b.vertexAttribPointer(g,f.numComponents,f.type||b.FLOAT,f.normalize||!1,d,c),c+=4*f.numComponents}},unbind:function(a){for(var b=this.gl,c=0;c<this._vertexAttribs.length;c++){var d=this._vertexAttribs[c],e=null===d.location?a.getAttributeLocation(d.name):d.location;b.disableVertexAttribArray(e)}}});d.Attrib=new c({name:null,numComponents:null,location:null,type:null,initialize:function(a,b,c,d,e){this.name=a,this.numComponents=b,this.location="number"==typeof c?c:null,this.type=d,this.normalize=e}}),b.exports=d},{jsOOP:11}],8:[function(a,b){var c=a("jsOOP").Class,d=new c({vertSource:null,fragSource:null,vertShader:null,fragShader:null,program:null,log:"",uniformCache:null,attributeCache:null,initialize:function(a,b,c,d){if(!b||!c)throw"vertex and fragment shaders must be defined";if(!a)throw"no GL context specified";this.context=a,this.attributeLocations=d,this.vertSource=b.trim(),this.fragSource=c.trim(),this.context.addManagedObject(this),this.create()},create:function(){this.gl=this.context.gl,this._compileShaders()},_compileShaders:function(){var a=this.gl;if(this.log="",this.vertShader=this._loadShader(a.VERTEX_SHADER,this.vertSource),this.fragShader=this._loadShader(a.FRAGMENT_SHADER,this.fragSource),!this.vertShader||!this.fragShader)throw"Error returned when calling createShader";if(this.program=a.createProgram(),a.attachShader(this.program,this.vertShader),a.attachShader(this.program,this.fragShader),this.attributeLocations)for(var b in this.attributeLocations)this.attributeLocations.hasOwnProperty(b)&&a.bindAttribLocation(this.program,Math.floor(this.attributeLocations[b]),b);if(a.linkProgram(this.program),this.log+=a.getProgramInfoLog(this.program)||"",!a.getProgramParameter(this.program,a.LINK_STATUS))throw"Error linking the shader program:\n"+this.log;this._fetchUniforms(),this._fetchAttributes()},_fetchUniforms:function(){var a=this.gl;this.uniformCache={};var b=a.getProgramParameter(this.program,a.ACTIVE_UNIFORMS);if(b)for(var c=0;b>c;c++){var d=a.getActiveUniform(this.program,c);if(null!==d){var e=d.name,f=a.getUniformLocation(this.program,e);this.uniformCache[e]={size:d.size,type:d.type,location:f}}}},_fetchAttributes:function(){var a=this.gl;this.attributeCache={};var b=a.getProgramParameter(this.program,a.ACTIVE_ATTRIBUTES);if(b)for(var c=0;b>c;c++){var d=a.getActiveAttrib(this.program,c);if(null!==d){var e=d.name,f=a.getAttribLocation(this.program,e);this.attributeCache[e]={size:d.size,type:d.type,location:f}}}},_loadShader:function(a,b){var c=this.gl,d=c.createShader(a);if(!d)return-1;c.shaderSource(d,b),c.compileShader(d);var e=c.getShaderInfoLog(d)||"";if(e){var f=a===c.VERTEX_SHADER?"vertex":"fragment";e="Error compiling "+f+" shader:\n"+e}if(this.log+=e,!c.getShaderParameter(d,c.COMPILE_STATUS))throw this.log;return d},getUniformInfo:function(a){return this.uniformCache[a]||null},getAttributeInfo:function(a){return this.attributeCache[a]||null},getAttributeLocation:function(a){var b=this.getAttributeInfo(a);return b?b.location:null},getUniformLocation:function(a){var b=this.getUniformInfo(a);return b?b.location:null},hasUniform:function(a){return null!==this.getUniformInfo(a)},hasAttribute:function(a){return null!==this.getAttributeInfo(a)},getUniform:function(a){return this.gl.getUniform(this.program,this.getUniformLocation(a))},getUniformAt:function(a){return this.gl.getUniform(this.program,a)},bind:function(){this.gl.useProgram(this.program)},destroy:function(){var a=this.gl;a.detachShader(this.vertShader),a.detachShader(this.fragShader),a.deleteShader(this.vertShader),a.deleteShader(this.fragShader),a.deleteProgram(this.program),this.program=null},setUniformi:function(a,b,c,d,e){var f=this.gl,g=this.getUniformLocation(a);if(!g)return!1;switch(arguments.length){case 2:return f.uniform1i(g,b),!0;case 3:return f.uniform2i(g,b,c),!0;case 4:return f.uniform3i(g,b,c,d),!0;case 5:return f.uniform4i(g,b,c,d,e),!0;default:throw"invalid arguments to setUniformi"}},setUniformf:function(a,b,c,d,e){var f=this.gl,g=this.getUniformLocation(a);if(!g)return!1;switch(arguments.length){case 2:return f.uniform1f(g,b),!0;case 3:return f.uniform2f(g,b,c),!0;case 4:return f.uniform3f(g,b,c,d),!0;case 5:return f.uniform4f(g,b,c,d,e),!0;default:throw"invalid arguments to setUniformf"}},setUniformfv:function(a,b){var c=this.gl,d=this.getUniformLocation(a);if(!d)return!1;switch(b.length){case 1:return c.uniform1fv(d,b),!0;case 2:return c.uniform2fv(d,b),!0;case 3:return c.uniform3fv(d,b),!0;case 4:return c.uniform4fv(d,b),!0;default:throw"invalid arguments to setUniformf"}},setUniformiv:function(a,b){var c=this.gl,d=this.getUniformLocation(a);if(!d)return!1;switch(b.length){case 1:return c.uniform1iv(d,b),!0;case 2:return c.uniform2iv(d,b),!0;case 3:return c.uniform3iv(d,b),!0;case 4:return c.uniform4iv(d,b),!0;default:throw"invalid arguments to setUniformf"}}});b.exports=d},{jsOOP:11}],9:[function(a,b){b.exports={AbstractBatch:a("./AbstractBatch.js"),AssetManager:a("./AssetManager.js"),Point:a("./Point.js"),SpriteBatch:a("./SpriteBatch.js"),Texture:a("./Texture.js"),WebGLContext:a("./WebGLContext.js"),Mesh:a("./glutils/Mesh.js"),ShaderProgram:a("./glutils/ShaderProgram.js"),glMatrix:a("gl-matrix").glMatrix,vec2:a("gl-matrix").vec2,vec3:a("gl-matrix").vec3,vec4:a("gl-matrix").vec4,mat2:a("gl-matrix").mat2,mat2d:a("gl-matrix").mat2d,mat3:a("gl-matrix").mat3,mat4:a("gl-matrix").mat4,quat:a("gl-matrix").quat,Class:a("jsOOP").Class,Enum:a("jsOOP").Enum,Interface:a("jsOOP").Interface,Signal:a("signals").Signal}},{"./AbstractBatch.js":1,"./AssetManager.js":2,"./Point.js":3,"./SpriteBatch.js":4,"./Texture.js":5,"./WebGLContext.js":6,"./glutils/Mesh.js":7,"./glutils/ShaderProgram.js":8,"gl-matrix":10,jsOOP:11,signals:16}],10:[function(b,c,d){!function(b){"use strict";var c={};"undefined"==typeof d?"function"==typeof a&&"object"==typeof a.amd&&a.amd?(c.exports={},a(function(){return c.exports})):c.exports="undefined"!=typeof window?window:b:c.exports=d,function(a){if(!b)var b=1e-6;if(!c)var c="undefined"!=typeof Float32Array?Float32Array:Array;if(!d)var d=Math.random;var e={};e.setMatrixArrayType=function(a){c=a},"undefined"!=typeof a&&(a.glMatrix=e);var f={};f.create=function(){var a=new c(2);return a[0]=0,a[1]=0,a},f.clone=function(a){var b=new c(2);return b[0]=a[0],b[1]=a[1],b},f.fromValues=function(a,b){var d=new c(2);return d[0]=a,d[1]=b,d},f.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},f.set=function(a,b,c){return a[0]=b,a[1]=c,a},f.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},f.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},f.sub=f.subtract,f.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},f.mul=f.multiply,f.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},f.div=f.divide,f.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},f.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},f.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},f.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},f.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},f.dist=f.distance,f.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},f.sqrDist=f.squaredDistance,f.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},f.len=f.length,f.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},f.sqrLen=f.squaredLength,f.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},f.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},f.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},f.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},f.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},f.random=function(a,b){b=b||1;var c=2*d()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},f.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},f.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},f.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},f.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},f.forEach=function(){var a=f.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),f.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},"undefined"!=typeof a&&(a.vec2=f);var g={};g.create=function(){var a=new c(3);return a[0]=0,a[1]=0,a[2]=0,a},g.clone=function(a){var b=new c(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},g.fromValues=function(a,b,d){var e=new c(3);return e[0]=a,e[1]=b,e[2]=d,e},g.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},g.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},g.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},g.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},g.sub=g.subtract,g.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},g.mul=g.multiply,g.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},g.div=g.divide,g.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},g.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},g.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},g.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},g.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},g.dist=g.distance,g.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},g.sqrDist=g.squaredDistance,g.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},g.len=g.length,g.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},g.sqrLen=g.squaredLength,g.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},g.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},g.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},g.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},g.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},g.random=function(a,b){b=b||1;var c=2*d()*Math.PI,e=2*d()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},g.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12],a[1]=c[1]*d+c[5]*e+c[9]*f+c[13],a[2]=c[2]*d+c[6]*e+c[10]*f+c[14],a},g.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},g.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},g.forEach=function(){var a=g.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),g.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},"undefined"!=typeof a&&(a.vec3=g);var h={};h.create=function(){var a=new c(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},h.clone=function(a){var b=new c(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},h.fromValues=function(a,b,d,e){var f=new c(4);return f[0]=a,f[1]=b,f[2]=d,f[3]=e,f},h.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},h.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},h.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},h.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},h.sub=h.subtract,h.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},h.mul=h.multiply,h.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},h.div=h.divide,h.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},h.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},h.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},h.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},h.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},h.dist=h.distance,h.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},h.sqrDist=h.squaredDistance,h.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},h.len=h.length,h.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},h.sqrLen=h.squaredLength,h.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},h.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=b[0]*g,a[1]=b[1]*g,a[2]=b[2]*g,a[3]=b[3]*g),a},h.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},h.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},h.random=function(a,b){return b=b||1,a[0]=d(),a[1]=d(),a[2]=d(),a[3]=d(),h.normalize(a,a),h.scale(a,a,b),a},h.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];
return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},h.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},h.forEach=function(){var a=h.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),h.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.vec4=h);var i={};i.create=function(){var a=new c(4);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},i.clone=function(a){var b=new c(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},i.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},i.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},i.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},i.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},i.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},i.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},i.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+e*j,a[1]=d*i+e*k,a[2]=f*h+g*j,a[3]=f*i+g*k,a},i.mul=i.multiply,i.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=d*-h+e*i,a[2]=f*i+g*h,a[3]=f*-h+g*i,a},i.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*i,a[2]=f*h,a[3]=g*i,a},i.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.mat2=i);var j={};j.create=function(){var a=new c(6);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},j.clone=function(a){var b=new c(6);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b},j.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a},j.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},j.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=c*f-d*e;return i?(i=1/i,a[0]=f*i,a[1]=-d*i,a[2]=-e*i,a[3]=c*i,a[4]=(e*h-f*g)*i,a[5]=(d*g-c*h)*i,a):null},j.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},j.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];return a[0]=d*j+e*l,a[1]=d*k+e*m,a[2]=f*j+g*l,a[3]=f*k+g*m,a[4]=j*h+l*i+n,a[5]=k*h+m*i+o,a},j.mul=j.multiply,j.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=Math.sin(c),k=Math.cos(c);return a[0]=d*k+e*j,a[1]=-d*j+e*k,a[2]=f*k+g*j,a[3]=-f*j+k*g,a[4]=k*h+j*i,a[5]=k*i-j*h,a},j.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=b[0]*d,a[1]=b[1]*e,a[2]=b[2]*d,a[3]=b[3]*e,a[4]=b[4]*d,a[5]=b[5]*e,a},j.translate=function(a,b,c){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4]+c[0],a[5]=b[5]+c[1],a},j.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},"undefined"!=typeof a&&(a.mat2d=j);var k={};k.create=function(){var a=new c(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},k.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},k.clone=function(a){var b=new c(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},k.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},k.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},k.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},k.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},k.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},k.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},k.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},k.mul=k.multiply,k.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},k.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},k.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},k.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},k.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-(m+o),a[3]=k+r,a[6]=l-q,a[1]=k-r,a[4]=1-(j+o),a[7]=n+p,a[2]=l+q,a[5]=n-p,a[8]=1-(j+m),a},k.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},k.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},"undefined"!=typeof a&&(a.mat3=k);var l={};l.create=function(){var a=new c(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.clone=function(a){var b=new c(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},l.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},l.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},l.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},l.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},l.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},l.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},l.mul=l.multiply,l.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},l.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},l.rotate=function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<b?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(d),g=Math.cos(d),h=1-g,i=c[0],j=c[1],k=c[2],l=c[3],m=c[4],n=c[5],o=c[6],p=c[7],q=c[8],r=c[9],s=c[10],t=c[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]),a)},l.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},l.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},l.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},l.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},l.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-(m+o),a[1]=k+r,a[2]=l-q,a[3]=0,a[4]=k-r,a[5]=1-(j+o),a[6]=n+p,a[7]=0,a[8]=l+q,a[9]=n-p,a[10]=1-(j+m),a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},l.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},l.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},l.lookAt=function(a,c,d,e){var f,g,h,i,j,k,m,n,o,p,q=c[0],r=c[1],s=c[2],t=e[0],u=e[1],v=e[2],w=d[0],x=d[1],y=d[2];return Math.abs(q-w)<b&&Math.abs(r-x)<b&&Math.abs(s-y)<b?l.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,f=u*o-v*n,g=v*m-t*o,h=t*n-u*m,p=Math.sqrt(f*f+g*g+h*h),p?(p=1/p,f*=p,g*=p,h*=p):(f=0,g=0,h=0),i=n*h-o*g,j=o*f-m*h,k=m*g-n*f,p=Math.sqrt(i*i+j*j+k*k),p?(p=1/p,i*=p,j*=p,k*=p):(i=0,j=0,k=0),a[0]=f,a[1]=i,a[2]=m,a[3]=0,a[4]=g,a[5]=j,a[6]=n,a[7]=0,a[8]=h,a[9]=k,a[10]=o,a[11]=0,a[12]=-(f*q+g*r+h*s),a[13]=-(i*q+j*r+k*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},l.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},"undefined"!=typeof a&&(a.mat4=l);var m={};m.create=function(){var a=new c(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},m.rotationTo=function(){var a=g.create(),b=g.fromValues(1,0,0),c=g.fromValues(0,1,0);return function(d,e,f){var h=g.dot(e,f);return-.999999>h?(g.cross(a,b,e),g.length(a)<1e-6&&g.cross(a,c,e),g.normalize(a,a),m.setAxisAngle(d,a,Math.PI),d):h>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(g.cross(a,e,f),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+h,m.normalize(d,d))}}(),m.setAxes=function(){var a=k.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=c[0],a[5]=c[1],a[8]=c[2],m.normalize(b,m.fromMat3(b,a))}}(),m.clone=h.clone,m.fromValues=h.fromValues,m.copy=h.copy,m.set=h.set,m.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},m.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},m.add=h.add,m.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},m.mul=m.multiply,m.scale=h.scale,m.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},m.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},m.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},m.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},m.dot=h.dot,m.lerp=h.lerp,m.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,0>f&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},m.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},m.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},m.length=h.length,m.len=m.length,m.squaredLength=h.squaredLength,m.sqrLen=m.squaredLength,m.normalize=h.normalize,m.fromMat3=function(){var a="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(b,c){var d,e=c[0]+c[4]+c[8];if(e>0)d=Math.sqrt(e+1),b[3]=.5*d,d=.5/d,b[0]=(c[7]-c[5])*d,b[1]=(c[2]-c[6])*d,b[2]=(c[3]-c[1])*d;else{var f=0;c[4]>c[0]&&(f=1),c[8]>c[3*f+f]&&(f=2);var g=a[f],h=a[g];d=Math.sqrt(c[3*f+f]-c[3*g+g]-c[3*h+h]+1),b[f]=.5*d,d=.5/d,b[3]=(c[3*h+g]-c[3*g+h])*d,b[g]=(c[3*g+f]+c[3*f+g])*d,b[h]=(c[3*h+f]+c[3*f+h])*d}return b}}(),m.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.quat=m)}(c.exports)}(this)},{}],11:[function(a,b){var c=a("./lib/Class"),d=a("./lib/Enum"),e=a("./lib/Interface");b.exports={Class:c,Enum:d,Interface:e}},{"./lib/Class":12,"./lib/Enum":13,"./lib/Interface":14}],12:[function(a,b,c){var d=a("./baseClass"),e=function(a){if(a||(a={}),a.initialize){var b=a.initialize;delete a.initialize}else b=function(){this.parent.apply(this,arguments)};a.Extends?(b.prototype=Object.create(a.Extends.prototype),b.$$parentConstructor=a.Extends,delete a.Extends):(b.$$parentConstructor=function(){},b.prototype=Object.create(d)),b.prototype.$$getters={},b.prototype.$$setters={};for(var c in a)"function"==typeof a[c]?(a[c].$$name=c,a[c].$$owner=b.prototype,b.prototype[c]=a[c]):a[c]&&"object"==typeof a[c]&&(a[c].get||a[c].set)?(Object.defineProperty(b.prototype,c,a[c]),a[c].get&&(b.prototype.$$getters[c]=a[c].get,a[c].get.$$name=c,a[c].get.$$owner=b.prototype),a[c].set&&(b.prototype.$$setters[c]=a[c].set,a[c].set.$$name=c,a[c].set.$$owner=b.prototype)):b.prototype[c]=a[c];b.$$isConstructor=!0;for(var c=1;c<arguments.length;c++)arguments[c].compare(b);return b};c=b.exports=e},{"./baseClass":15}],13:[function(a,b,c){var d=a("./Class"),e=new d({values:null,initialize:function(){this.values=[]},toString:function(){return"[ "+this.values.join(", ")+" ]"},fromValue:function(a){for(var b=0;b<this.values.length;b++)if(a===this.values[b].value)return this.values[b];return null}}),f=function(a,b){b||(b=f.Base),"object"==typeof b&&(b.Extends||(b.Extends=f.Base),b=new d(b));for(var c=new e,g=0;g<a.length;g++){var h=a[g],i=null,j=null;if(!h)throw"enum value at index "+g+" is undefined";if("string"==typeof h)j=h,i=new b(h),c[h]=i;else{if(!Array.isArray(h))throw"enum values must be String or an array of arguments";j=h[0],h.unshift(null),i=new(Function.prototype.bind.apply(b,h)),c[j]=i}if(!(i instanceof f.Base))throw"enum base class must be a subclass of Enum.Base";i.ordinal=g,c.values.push(i),Object.freeze(i)}return Object.freeze(c.values),c};f.Base=new d({value:void 0,ordinal:void 0,initialize:function(a){this.value=a},toString:function(){return this.value||this.parent()},valueOf:function(){return this.value||this.parent()}}),c=b.exports=f},{"./Class":12}],14:[function(a,b,c){var d=function(a){this.descriptor=a};d.prototype.descriptor=null,d.prototype.compare=function(a){for(var b in this.descriptor){if(void 0===a.prototype[b])throw"INTERFACE ERROR: "+b+" is not defined in the class";if(typeof this.descriptor[b]!=typeof a.prototype[b])throw"INTERFACE ERROR: Interface and class define items of different type for "+b+"\ninterface[ "+b+" ] == "+typeof this.descriptor[b]+"\nclass[ "+b+" ] == "+typeof a.prototype[b];if("function"==typeof this.descriptor[b]&&a.prototype[b].length!=this.descriptor[b].length)throw"INTERFACE ERROR: Interface and class expect a different amount of parameters for the function "+b+"\nEXPECTED: "+this.descriptor[b].length+"\nRECEIVED: "+a.prototype[b].length}},c=b.exports=d},{}],15:[function(a,b){b.exports.parent=function(){if(this.parent.caller.$$isConstructor)var a=this.parent.caller.$$parentConstructor;else{if(!this.parent.caller.$$name)throw"You cannot call parent here";var b=this.parent.caller.$$name,c=this.parent.caller.$$owner.$$getters[b],d=this.parent.caller.$$owner.$$setters[b];if(1==arguments.length&&d){var a=Object.getPrototypeOf(this.parent.caller.$$owner).$$setters[b];if(void 0===a)throw"No setter defined in parent"}else if(0==arguments.length&&c){var a=Object.getPrototypeOf(this.parent.caller.$$owner).$$getters[b];if(void 0===a)throw"No getter defined in parent"}else{if(d||c)throw"Incorrect amount of arguments sent to getter or setter";var a=Object.getPrototypeOf(this.parent.caller.$$owner)[b];if(void 0===a)throw"No parent function defined for "+b}}return a.apply(this,arguments)}},{}],16:[function(b,c){!function(b){function d(a,b,c,d,e){this._listener=b,this._isOnce=c,this.context=d,this._signal=a,this._priority=e||0}function e(a,b){if("function"!=typeof a)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))}function f(){this._bindings=[],this._prevParams=null;var a=this;this.dispatch=function(){f.prototype.dispatch.apply(a,arguments)}}d.prototype={active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,c),this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},f.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,b,c,e){var f,g=this._indexOfListener(a,c);if(-1!==g){if(f=this._bindings[g],f.isOnce()!==b)throw new Error("You cannot add"+(b?"":"Once")+"() then add"+(b?"Once":"")+"() the same listener without removing the relationship first.")}else f=new d(this,a,b,c,e),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){return e(a,"add"),this._registerListener(a,!1,b,c)},addOnce:function(a,b,c){return e(a,"addOnce"),this._registerListener(a,!0,b,c)},remove:function(a,b){e(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var g=f;g.Signal=f,"function"==typeof a&&a.amd?a(function(){return g}):"undefined"!=typeof c&&c.exports?c.exports=g:b.signals=g}(this)},{}]},{},[9])(9)});